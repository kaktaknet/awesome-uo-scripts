//Statlock System Created by GM Sven
//Created for Flinthills Gamer
//Copyright Sven, do not remove this header.

//To install allow players to use .statlock and add script to scripts directory.





[FUNCTION statlock]
IF (0<SRC.TAG.STRSTAT>=0)
	SRC.TAG.STRSTAT="Going Up"
	SRC.TAG.STRLOCK=0
ENDIF
IF (0<SRC.TAG.DEXSTAT>=0)
	SRC.TAG.DEXSTAT="Going Up"
	SRC.TAG.DEXLOCK=0
ENDIF
IF (0<SRC.TAG.INTSTAT>=0)
	SRC.TAG.INTSTAT="Going Up"
	SRC.TAG.INTLOCK=0
ENDIF
MENU M_STATLOCK
RETURN 1

[MENU M_STATLOCK]
Which stat do you wish to adjust?
ON=0 Strength is <SRC.TAG.STRSTAT> from <EVAL <SRC.TAG.STRLOCK>>.
	MENU M_STATLOCK_STR
	RETURN 1
ON=0 Dexterity is <SRC.TAG.DEXSTAT> from <EVAL <SRC.TAG.DEXLOCK>>.
	MENU M_STATLOCK_DEX
	RETURN 1
ON=0 Intelligence is <SRC.TAG.INTSTAT> from <EVAL <SRC.TAG.INTLOCK>>.
	MENU M_STATLOCK_INT
	RETURN 1
ON=0 Refresh Stats
	statlock_main
	RETURN 0

[MENU M_STATLOCK_STR]
How do you wish to set Strength?
ON=0 Set Strength to Go Up.
	SRC.TAG.STRSTAT="Going Up"
	SRC.TAG.STRLOCK=-1
	SRC.SYSMESSAGE Your Str is now set to Go Up. Refresh Stats for this to take effect.
	MENU M_STATLOCK
	RETURN 0

ON=0 Lock Strength
	SRC.TAG.STRSTAT="Locked"
	SRC.TAG.STRLOCK=-1
	SRC.SYSMESSAGE Your Str is now Locked. Refresh Stats for this to take effect.
	MENU M_STATLOCK
	RETURN 0


ON=0 Set Strength to Go Down.
	SRC.TAG.STRSTAT="Going Down"
	SRC.TAG.STRLOCK=-1
	SRC.SYSMESSAGE Your Str is now set to Go Down. Refresh Stats for this to take effect.
	MENU M_STATLOCK
	RETURN 0

[MENU M_STATLOCK_DEX]
How do you wish to set Dexterity?
ON=0 Set Dexterity to Go Up.
	SRC.TAG.DEXSTAT="Going Up"
	SRC.TAG.DEXLOCK=-1
	SRC.SYSMESSAGE Your Dexterity is now set to Go Up. Refresh Stats for this to take effect.
	MENU M_STATLOCK
	RETURN 0

ON=0 Lock Dexterity
	SRC.TAG.DEXSTAT="Locked"
	SRC.TAG.DEXLOCK=-1
	SRC.SYSMESSAGE Your Dexterity is now Locked. Refresh Stats for this to take effect.
	MENU M_STATLOCK
	RETURN 0


ON=0 Set Dexterity to Go Down.
	SRC.TAG.DEXSTAT="Going Down"
	SRC.TAG.DEXLOCK=-1
	SRC.SYSMESSAGE Your Dexterity is now set to Go Down. Refresh Stats for this to take effect.
	MENU M_STATLOCK
	RETURN 0
	
[MENU M_STATLOCK_INT]
How do you wish to set Intelligence?
ON=0 Set Intelligence to Go Up.
	SRC.TAG.INTSTAT="Going Up"
	SRC.TAG.INTLOCK=-1
	SRC.SYSMESSAGE Your Intelligence is now set to Go Up. Refresh Stats for this to take effect.
	MENU M_STATLOCK
	RETURN 0

ON=0 Lock Intelligence
	SRC.TAG.INTSTAT="Locked"
	SRC.TAG.INTLOCK=-1
	SRC.SYSMESSAGE Your Intelligence is now Locked. Refresh Stats for this to take effect.
	MENU M_STATLOCK
	RETURN 0

ON=0 Set Intelligence to Go Down.
	SRC.TAG.INTSTAT="Going Down"
	SRC.TAG.INTLOCK=-1
	SRC.SYSMESSAGE Your Intelligence is now set to Go Down. Refresh Stats for this to take effect.
	MENU M_STATLOCK
	RETURN 0
	
[EVENTS e_statlock]
ON=@LOGIN
statlock_main
RETURN 1

[FUNCTION statlock_main]
SRC.NEWITEM i_bag
SRC.ACT.CONT <FINDLAYER.layer_pack.UID>
FINDLAYER.layer_hand1.CONT		<SRC.ACT.UID>
FINDLAYER.layer_hand2.CONT		<SRC.ACT.UID>
FINDLAYER.layer_shoes.CONT		<SRC.ACT.UID>
FINDLAYER.layer_pants.CONT		<SRC.ACT.UID>
FINDLAYER.layer_shirt.CONT		<SRC.ACT.UID>
FINDLAYER.layer_helm.CONT		<SRC.ACT.UID>
FINDLAYER.layer_gloves.CONT		<SRC.ACT.UID>
FINDLAYER.layer_ring.CONT		<SRC.ACT.UID>
FINDLAYER.layer_light.CONT		<SRC.ACT.UID>
FINDLAYER.layer_collar.CONT		<SRC.ACT.UID>
FINDLAYER.layer_half_apron.CONT		<SRC.ACT.UID>
FINDLAYER.layer_chest.CONT		<SRC.ACT.UID>
FINDLAYER.layer_wrist.CONT		<SRC.ACT.UID>
FINDLAYER.layer_tunic.CONT		<SRC.ACT.UID>
FINDLAYER.layer_ears.CONT		<SRC.ACT.UID>
FINDLAYER.layer_arms.CONT		<SRC.ACT.UID>
FINDLAYER.layer_cape.CONT		<SRC.ACT.UID>
FINDLAYER.layer_robe.CONT		<SRC.ACT.UID>
FINDLAYER.layer_skirt.CONT		<SRC.ACT.UID>
FINDLAYER.layer_legs.CONT		<SRC.ACT.UID>
FINDLAYER.LAYER_SPELL_STATS.REMOVE
FINDLAYER.47.REMOVE //This is alchohol Effect

IF (<EVAL <SRC.TAG.STRLOCK>> == -1)
	SRC.TAG.STRLOCK <SRC.STR>
ENDIF
IF (<EVAL <SRC.TAG.DEXLOCK>> == -1)
	SRC.TAG.DEXLOCK <SRC.DEX>
ENDIF
IF (<EVAL <SRC.TAG.INTLOCK>> == -1)
	SRC.TAG.INTLOCK <SRC.INT>
ENDIF

SRC.TAG.TEMSTR=<SRC.STR>
SRC.TAG.TEMDEX=<SRC.DEX>
SRC.TAG.TEMINT=<SRC.INT>


IF !(<SRC.TAG.DEXLOCK> == <SRC.DEX>) && (STRMATCH("<SRC.TAG.DEXSTAT>","Locked"))
	SRC.TAG.TEMDEX=<SRC.TAG.DEXLOCK>
ELSEIF (<SRC.TAG.DEXLOCK> >= <SRC.DEX>) && (STRMATCH("<SRC.TAG.DEXSTAT>","Going Up"))
	SRC.TAG.TEMDEX=<SRC.TAG.DEXLOCK>
ELSEIF (<SRC.TAG.DEXLOCK> <= <SRC.DEX>) && (STRMATCH("<SRC.TAG.DEXSTAT>","Going Down"))
	SRC.TAG.TEMDEX=<SRC.TAG.DEXLOCK>
ENDIF
IF !(<SRC.TAG.STRLOCK> == <SRC.STR>) && (STRMATCH("<SRC.TAG.STRSTAT>","Locked"))
	SRC.TAG.TEMSTR=<SRC.TAG.STRLOCK>
ELSEIF (<SRC.TAG.STRLOCK> >= <SRC.STR>) && (STRMATCH("<SRC.TAG.STRSTAT>","Going Up"))
	SRC.TAG.TEMSTR=<SRC.TAG.STRLOCK>
ELSEIF (<SRC.TAG.STRLOCK> <= <SRC.STR>) && (STRMATCH("<SRC.TAG.STRSTAT>","Going Down"))
	SRC.TAG.TEMSTR=<SRC.TAG.STRLOCK>
ENDIF
IF !(<SRC.TAG.INTLOCK> == <SRC.INT>) && (STRMATCH("<SRC.TAG.INTSTAT>","Locked"))
	SRC.TAG.TEMINT=<SRC.TAG.INTLOCK>
ELSEIF (<SRC.TAG.INTLOCK> >= <SRC.INT>) && (STRMATCH("<SRC.TAG.INTSTAT>","Going Up"))
	SRC.TAG.TEMINT=<SRC.TAG.INTLOCK>
ELSEIF (<SRC.TAG.INTLOCK> <= <SRC.INT>) && (STRMATCH("<SRC.TAG.INTSTAT>","Going Down"))
	SRC.TAG.TEMINT=<SRC.TAG.INTLOCK>
ENDIF

IF (STRMATCH("<SRC.TAG.INTSTAT>","Going Down"))
SRC.TAG.TEMSTAT=<eval (270+-(0<SRC.TAG.TEMSTR> + 0<SRC.TAG.TEMDEX> + 0<SRC.TAG.TEMINT>))>	
	IF (<SRC.TAG.TEMSTAT> <= 0)
	IF <EVAL ((<SRC.TAG.TEMINT>+<SRC.TAG.TEMSTAT>)> > 0)
			SRC.TAG.TEMINT=<EVAL (<SRC.TAG.TEMINT>+<SRC.TAG.TEMSTAT>)>
		ELSE
			SRC.TAG.TEMINT=0
		ENDIF
	ENDIF
ENDIF

IF (STRMATCH("<SRC.TAG.DEXSTAT>","Going Down"))
SRC.TAG.TEMSTAT=<eval (270+-(0<SRC.TAG.TEMSTR> + 0<SRC.TAG.TEMDEX> + 0<SRC.TAG.TEMINT>))>	
	IF (<SRC.TAG.TEMSTAT> <= 0)
	IF <EVAL ((<SRC.TAG.TEMDEX>+<SRC.TAG.TEMSTAT>)> > 0)
			SRC.TAG.TEMDEX=<EVAL (<SRC.TAG.TEMDEX>+<SRC.TAG.TEMSTAT>)>
		ELSE
			SRC.TAG.TEMDEX=0
		ENDIF
	ENDIF
ENDIF

IF (STRMATCH("<SRC.TAG.STRSTAT>","Going Down"))
SRC.TAG.TEMSTAT=<eval (270+-(0<SRC.TAG.TEMSTR> + 0<SRC.TAG.TEMDEX> + 0<SRC.TAG.TEMINT>))>	
	IF (<SRC.TAG.TEMSTAT> <= 0)
	IF <EVAL ((<SRC.TAG.TEMSTR>+<SRC.TAG.TEMSTAT>)> > 0)
			SRC.TAG.TEMSTR=<EVAL (<SRC.TAG.TEMSTR>+<SRC.TAG.TEMSTAT>)>
		ELSE
			SRC.TAG.TEMSTR=0
		ENDIF
	ENDIF
ENDIF

IF (STRMATCH("<SRC.TAG.INTSTAT>","Going Up"))
SRC.TAG.TEMSTAT=<eval (270+-(0<SRC.TAG.TEMSTR> + 0<SRC.TAG.TEMDEX> + 0<SRC.TAG.TEMINT>))>	
	IF (<SRC.TAG.TEMSTAT> <= 0)
	IF <EVAL ((0<SRC.TAG.TEMINT>+0<SRC.TAG.TEMSTAT>)> > 0)
			SRC.TAG.TEMINT=<EVAL (<SRC.TAG.TEMINT>+<SRC.TAG.TEMSTAT>)>
		ELSE
			SRC.TAG.TEMINT=0
		ENDIF
	ENDIF
ENDIF

IF (STRMATCH("<SRC.TAG.DEXSTAT>","Going Up"))
SRC.TAG.TEMSTAT=<eval (270+-(0<SRC.TAG.TEMSTR> + 0<SRC.TAG.TEMDEX> + 0<SRC.TAG.TEMINT>))>	
	IF (<SRC.TAG.TEMSTAT> <= 0)
	IF <EVAL ((0<SRC.TAG.TEMDEX>+0<SRC.TAG.TEMSTAT>)> > 0)
			SRC.TAG.TEMDEX=<EVAL (<SRC.TAG.TEMDEX>+<SRC.TAG.TEMSTAT>)>
		ELSE
			SRC.TAG.TEMDEX=0
		ENDIF
	ENDIF
ENDIF

IF (STRMATCH("<SRC.TAG.STRSTAT>","Going Up"))
SRC.TAG.TEMSTAT=<eval (270+-(0<SRC.TAG.TEMSTR> + 0<SRC.TAG.TEMDEX> + 0<SRC.TAG.TEMINT>))>	
	IF (<SRC.TAG.TEMSTAT> <= 0)
	IF <EVAL ((0<SRC.TAG.TEMSTR>+0<SRC.TAG.TEMSTAT>)> > 0)
			SRC.TAG.TEMSTR=<EVAL (<SRC.TAG.TEMSTR>+<SRC.TAG.TEMSTAT>)>
		ELSE
			SRC.TAG.TEMSTR=0
		ENDIF
	ENDIF
ENDIF

IF (STRMATCH("<SRC.TAG.INTSTAT>","Locked"))
SRC.TAG.TEMSTAT=<eval (270+-(0<SRC.TAG.TEMSTR> + 0<SRC.TAG.TEMDEX> + 0<SRC.TAG.TEMINT>))>	
	IF (<SRC.TAG.TEMSTAT> <= 0)
	IF <EVAL ((0<SRC.TAG.TEMINT>+0<SRC.TAG.TEMSTAT>)> > 0)
			SRC.TAG.TEMINT=<EVAL (<SRC.TAG.TEMINT>+<SRC.TAG.TEMSTAT>)>
		ELSE
			SRC.TAG.TEMINT=0
		ENDIF
	ENDIF
ENDIF

IF (STRMATCH("<SRC.TAG.DEXSTAT>","Locked"))
SRC.TAG.TEMSTAT=<eval (270+-(0<SRC.TAG.TEMSTR> + 0<SRC.TAG.TEMDEX> + 0<SRC.TAG.TEMINT>))>	
	IF (<SRC.TAG.TEMSTAT> <= 0)
	IF <EVAL ((0<SRC.TAG.TEMDEX>+0<SRC.TAG.TEMSTAT>)> > 0)
			SRC.TAG.TEMDEX=<EVAL <SRC.TAG.TEMDEX>+<SRC.TAG.TEMSTAT>>
		ELSE
			SRC.TAG.TEMDEX=0
		ENDIF
	ENDIF
ENDIF

IF (STRMATCH("<SRC.TAG.STRSTAT>","Locked"))
SRC.TAG.TEMSTAT=<eval (270+-(0<SRC.TAG.TEMSTR> + 0<SRC.TAG.TEMDEX> + 0<SRC.TAG.TEMINT>))>	
	IF (<SRC.TAG.TEMSTAT> <= 0)
	IF <EVAL ((0<SRC.TAG.TEMSTR>+0<SRC.TAG.TEMSTAT>)> > 0)
			SRC.TAG.TEMSTR=<EVAL (<SRC.TAG.TEMSTR>+<SRC.TAG.TEMSTAT>)>
		ELSE
			SRC.TAG.TEMSTR=0
		ENDIF
	ENDIF
ENDIF
SRC.STR=<SRC.TAG.TEMSTR>
SRC.DEX=<SRC.TAG.TEMDEX>
SRC.INT=<SRC.TAG.TEMINT>
SRC.TAG.TEMSTR=
SRC.TAG.TEMDEX=
SRC.TAG.TEMINT=
SRC.TAG.TEMSTAT=
IF (<SRC.ACT.RESCOUNT> == 0)
SRC.ACT.REMOVE
RETURN 1
ENDIF
statlock_reequip <EVAL <SRC.ACT.RESCOUNT>+-1>
SRC.ACT.REMOVE
RETURN 1


[FUNCTION statlock_reequip]
SRC.TRY SRC.UID.<SRC.ACT.UID>.FINDCONT.<ARGN>.EQUIP
IF <ARGN> > 0
statlock_reequip <EVAL <ARGN>+-1>
RETURN 1
ELSE
SRC.ACT.REMOVE
RETURN 1
ENDIF

