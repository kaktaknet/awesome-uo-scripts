[script]
n0=alias sphere {
n1=  echo -a -
n2=  echo -a -!- SPHERE IRCadmin version 2.9 Improved by hypnetric
n3=  echo -a -!- Bug fixes for 2.0 Improved:
n4=  echo -a -!- -
n5=  echo -a -!- #1. Checks to see if socket messages are real before carrying out action.
n6=  echo -a -!- #2. Removed unnecessary code.
n7=  echo -a -!- #3. Made everything easier to read on output.
n8=  echo -a -!- #4. Created option to use or not use a channel to relay socket messages.
n9=  echo -a -!- #5. Replaced output display.
n10=  echo -a -!- #6. CTCP system for public command access checks for errors on submission.
n11=  echo -a -!- #7. CTCP commands now work for all SphereServer versions.
n12=  echo -a -!- #8. Fixed bug with % $+ sphere.chan where it will now check for a hash prefix, and if not found, still processes correctly.
n13=  echo -a -!- -
n14=  echo -a -!- Bug fixes for 2.2 Improved:
n15=  echo -a -!- -
n16=  echo -a -!- #1. There was a problem with the '/no_relay' command, so it's now fixed.
n17=  echo -a -!- #2. Fixed some doubled inquisited message errors.
n18=  echo -a -!- -
n19=  echo -a -!- Bug fixes for 2.9 Improved Final (current version):
n20=  echo -a -!- #1. Just fixed some stuff.
n21=  echo -a -!- -----------------------------------------
n22=  echo -a -!- Original SPHERE IRCadmin version 1.0 by 
n23=  echo -a -!- RoseThorn and zero
n24=  echo -a -!- -----------------------------------------
n25=  echo -a -!- SPHERE IRCadmin Setup Procedure & Commands:
n26=  echo -a -!- - /spheresetup (set it up)
n27=  echo -a -!- - /spherecon (connects you to the remote admin)
n28=  echo -a -!- -
n29=  echo -a -!- - If you're using Sphere 0.55i, type: /sphere_55i
n30=  echo -a -!- - If you're using Sphere 99x+, type: /sphere_99x
n31=  echo -a -!- -
n32=  echo -a -!- - To disable channel message relay, type: /no_relay
n33=  echo -a -!- -
n34=  echo -a -!- - *** Be sure to follow all the commands above! ***
n35=  echo -a -
n36=  echo -a -!- - Right click in any window for commands also.
n37=  echo -a -
n38=}
n39=alias sphere_55i {
n40=  set %sphere.ver 0.55i
n41=  echo -a -
n42=  echo -a -!- SphereServer version set to 0.55i.
n43=  echo -a -
n44=}
n45=alias sphere_99x {
n46=  set %sphere.ver 0.99x
n47=  echo -a -
n48=  echo -a -!- SphereServer version set to 0.99x.
n49=  echo -a -
n50=}
n51=alias no_relay {
n52=  set %sphere.chan NONE
n53=}
n54=alias echos {
n55=  echo @Sphere $1-
n56=}
n57=alias sends {
n58=  if (undefined keyword isin $1-) { return }
n59=  else {
n60=    if ( (%sphere.chan == $null) || (%sphere.chan == NONE) ) {
n61=      halt
n62=    }
n63=    else {
n64=      if ($left(%sphere.chan,1) != $chr(35)) {
n65=        set %sphere.chan # $+ %sphere.chan
n66=        msg %sphere.chan $1-
n67=      }
n68=      else {
n69=        msg %sphere.chan $1-
n70=      }
n71=    }
n72=  }
n73=}
n74=alias spheresetup {  
n75=  dialog -m sphere sphere
n76=} 
n77=alias spherecon {
n78=  if ( (%sphere.ip == $null) || (%sphere.port == $null) ) {
n79=    echo -a -
n80=    echo -a -!- Type /spheresetup please.
n81=    echo -a -
n82=  }
n83=  else {
n84=    sockopen sphere %sphere.ip %sphere.port
n85=    window -e @Sphere
n86=  }
n87=}
n88=on 1:sockopen:sphere:{  
n89=  echos [console output] Connection to $sock(sphere).ip opened.
n90=  sends [global output] Connection to $sock(sphere).ip opened.
n91=  ;sends [global output] Running SPHERE IRCadmin 2.0 Improved, by hypnetric
n92=  bset &z 1 32
n93=  sockwrite sphere &z
n94=  if (%sphere.ver == 1) {
n95=    .timerwait 1 1 sockwrite -tn sphere %sphere.pass
n96=  }
n97=  elseif (%sphere.ver == 2) {
n98=    .timerw 1 1 sockwrite -tn sphere %sphere.name
n99=    .timerwait 1 2 sockwrite -tn sphere %sphere.pass
n100=  }
n101=}
n102=on 1:sockclose:sphere:{  
n103=  echos [console output] Connection to $sock(sphere).ip closed.
n104=  sends [global output] Connection to $sock(sphere).ip closed.
n105=} 
n106=on 1:sockread:sphere:{
n107=  if ($sockerr > 0) {
n108=    echos Cannot connect to $sock(sphere).ip $+ .
n109=    sends [global output] Cannot connect to $sock(sphere).ip $+ .
n110=    sockclose sphere 
n111=  } 
n112=  :continue
n113=  sockread %temp
n114=  if ($sockbr == 0) { return }
n115=  elseif (%temp == $null) { set %temp - }
n116=  elseif ( ($chr(37) isin %temp) && ( isin %temp) ) { halt }
n117=  elseif (Says !isincs %temp && UNICODE !isincs %temp) {
n118=    if (world data saved isin %temp) {
n119=      echos [console output] World saved.
n120=      sends [global output] World saved.
n121=      halt
n122=    }
n123=    elseif (:CRITICAL: isin $gettok(%temp,1-,32)) { sends [global output/critical] %temp }
n124=    elseif (:FATAL: isin $gettok(%temp,1-,32)) { sends [global output/fatal] %temp }
n125=    elseif ( ( (:ERROR: isin $gettok(%temp,1-,32)) && (too complex !isin %temp) && (Timer expired without DECAY flag !isin %temp) ) ) { sends [global output/error] %temp }
n126=    elseif (:WARNING: isin $gettok(%temp,1-,32)) { sends [global output/warning] %temp }
n127=    elseif (are not privileged to do that isin %temp) { sends [global output] %temp }
n128=    elseif (:GM Page from isin %temp) { sends [global output/page] %temp }
n129=  }
n130=  echos [console output] %temp
n131=  goto continue
n132=} 
n133=on 1:input:@Sphere:{
n134=  echo @Sphere > $1-
n135=  sockwrite -tn sphere $1-
n136=  if ($1 == /close) {
n137=    sockclose sphere
n138=  }
n139=}
n140=on 1:close:@Sphere:{
n141=  sockclose sphere 
n142=}
n143=dialog sphere {
n144=  title "Sphere Remote Console"
n145=  option pixel
n146=  size -1 -1 410 250
n147=
n148=  button "OK",10, 275 226 40 16, ok
n149=  button "Apply",11, 320 226 40 16
n150=  button "Cancel",12, 365 226 40 16, cancel
n151=  link "www.sphereserver.com", 13, 50 226 150 20
n152=
n153=  box "",100, 10 10 380 200
n154=  box "Version", 101, 15 25 75 75
n155=  radio "48e-55i",102, 25 40 55 30
n156=  radio "99f+",103, 25 65 50 30
n157=  text "Username",104, 140 30 75 20
n158=  edit "", 105, 200 30 120 20
n159=  text "Password",106, 140 50 75 20
n160=  edit "",107, 200 50 120 20, pass
n161=  text "Server IP",108, 140 90 75 20
n162=  edit "",109, 200 90 120 20
n163=  text "Server Port",110, 140 110 75 20
n164=  edit "",111, 200 110 120 20
n165=  button "Connect",112, 35 180 75 25
n166=  button "Disconnect",113, 150 180 85 25
n167=  button "Help?!",114, 270 180 75 25
n168=  text "Error Chan",115, 140 150 75 20
n169=  edit "", 116, 200 150 120 20
n170=}
n171=on 1:dialog:sphere:init:*:{
n172=  if (%sphere.ver == 1) { did -c $dname 102 }
n173=  elseif (%sphere.ver == 2) { did -c $dname 103 }
n174=  did -o $dname 105 1 %sphere.name
n175=  did -o $dname 107 1 %sphere.pass
n176=  did -o $dname 109 1 %sphere.ip
n177=  did -o $dname 111 1 %sphere.port
n178=  did -o $dname 116 1 %sphere.chan
n179=  did -b $dname 105
n180=  if (%sphere.ver == 2) { did -e $dname 105 }
n181=}
n182=on 1:dialog:sphere:dclick:13:{ run http://www.sphereserver.com }
n183=on 1:dialog:sphere:sclick:*:{
n184=  if ($did == 10 || $did == 11) {
n185=    set %sphere.name $did($dname,105).text 
n186=    set %sphere.pass $did($dname,107).text
n187=    set %sphere.ip $did($dname,109).text
n188=    set %sphere.port $did($dname,111).text
n189=    set %sphere.chan $did($dname,116).text
n190=    if ($did($dname,102).state == 1) {
n191=      set %sphere.ver 1
n192=      did -b $dname 105
n193=    }
n194=    elseif ($did($dname,103).state == 1) {
n195=      set %sphere.ver 2
n196=      did -e $dname 105
n197=    }
n198=  }
n199=  if ($did == 112) { spherecon }
n200=  if ($did == 113) {
n201=    close -@ @Sphere
n202=    sockclose sphere
n203=    echos [console output] SphereControl session closed.
n204=    sends [global output] SphereControl session closed.
n205=  }
n206=  if ($did == 114) { dialog -m spherehelp spherehelp }
n207=}
n208=dialog spherehelp {
n209=  title "Sphere Help"
n210=  size -1 -1 100 115
n211=  option dbu
n212=  edit "",1,5 5 90 90,vsbar,multi,read
n213=  button "Close",2,65 100 30 10,ok,default
n214=}
n215=on *:dialog:spherehelp:init:0:{
n216=  loadbuf -po spherehelp 1 $shortfn($mircdirsystem/sphere.txt)
n217=}
n218=menu status,channel,menubar,query,@Sphere {
n219=  SphereControl:dialog -m sphere sphere
n220=}
n221=menu nicklist {
n222=  SphereControl
n223=  .Turn botmode
n224=  ..on:set %sphere.bot 1
n225=  ..off:set %sphere.bot 0
n226=  .Add as GM
n227=  ..$address($1,0) { auser -a =5 $address($1,0) }
n228=  ..$address($1,1) { auser -a =5 $address($1,1) }
n229=  ..$address($1,2) { auser -a =5 $address($1,2) }
n230=  ..$address($1,3) { auser -a =5 $address($1,3) }
n231=  ..$address($1,4) { auser -a =5 $address($1,4) }
n232=  ..other { auser -a =5 $$?="Enter hostmask of $1 to add" }
n233=  .Remove GM
n234=  ..$address($1,0) { ruser =5 $address($1,0) }
n235=  ..$address($1,1) { ruser =5 $address($1,1) }
n236=  ..$address($1,2) { ruser =5 $address($1,2) }
n237=  ..$address($1,3) { ruser =5 $address($1,3) }
n238=  ..$address($1,4) { ruser =5 $address($1,4) }
n239=  ..other { ruser =5 $$?="Enter hostmask of $1 to remove" }
n240=  .Set GM botpass:set %sphere.botpass $$?="Enter botpassword for users to remote resync and save."
n241=  .Help!:{ 
n242=    echo -a 04Quick readme! 
n243=    echo -a --------------------------
n244=    echo -a GMs added with this will be able to control your server through you. GMs should be added with care! Do not add people you do not completely trust with your shard.
n245=    echo -a -
n246=    echo -a If they have a static (unchanging) IP you will be better off adding the full hostmask. Do *not* add something like *!*@*.aol.com it's NOT SAFE!
n247=    echo -a -
n248=    echo -a To remove someone right click and pick the same hostmask you added.
n249=    echo -a -
n250=    echo -a To remove someone not logged on, press ALT+R in mIRC, click the Users tab, delete their entry, press OK. Or type in the host manually in "other".
n251=    echo -a -
n252=    echo -a All users added will use the same pass you specify in "Set GM botpass". 
n253=    echo -a -
n254=    echo -a Their commands will be as following: /ctcp yourname botpass <command>. For example /ctcp SomeDood somepass save (will force a world save).
n255=    echo -a -
n256=    echo -a Change your botpass frequently and make it something people can NOT guess. ie - don't be lame and make  it 123 or abc or uo. Always change it if you fire a GM or have one quit.
n257=    echo -a -
n258=  }
n259=}
n260=ctcp +5:*:?:{
n261=  if (%sphere.bot != 1) {
n262=    .notice $nick Sorry, Sphere remote bot access is currently turned off.
n263=    halt
n264=  }
n265=  if ($1 != %sphere.botpass) {
n266=    .notice $nick Sorry, wrong password.
n267=    return
n268=  }
n269=  else {
n270=    if ($2 == resync) {
n271=      sockwrite -tn sphere r
n272=      sockwrite -tn sphere r
n273=      .notice $nick Resync complete.
n274=      return
n275=    }
n276=    elseif ($2 == save) {
n277=      sockwrite -tn sphere $chr(35)
n278=      .notice $nick Initiated save.
n279=      return
n280=    }
n281=    elseif ( ($2 == jail) && ($3 != $null) ) {
n282=      if (%sphere.ver == 0.55i) { sockwrite -tn sphere account $3 jail 1 }
n283=      elseif (%sphere.ver == 0.99x) { sockwrite -tn sphere accountmgr $3 jail 1 }
n284=      .notice $nick Jailed account: $3 $+ .
n285=      sends Jailed account: $3 for $nick $+ .
n286=      return
n287=    }
n288=    elseif ( ($2 == unjail) && ($3 != $null) ) {
n289=      if (%sphere.ver == 0.55i) { sockwrite -tn sphere account $3 jail 0 }
n290=      elseif (%sphere.ver == 0.99x) { sockwrite -tn sphere accountmgr $3 jail 0 }
n291=      .notice $nick Forgave account: $3 $+ .
n292=      sends  Forgave account: $3 for $nick $+ .
n293=      return
n294=    }
n295=    elseif ( ($2 == ban || $2 == block || $2 == kick) && ($3 != $null) ) {
n296=      if (%sphere.ver == 0.55i) { sockwrite -tn sphere account $3 block 1 }
n297=      elseif (%sphere.ver == 0.99x) { sockwrite -tn sphere accountmgr $3 block 1 }
n298=      .notice $nick Banned account: $3 $+ .
n299=      sockwrite -tn sphere A
n300=      sends Banned account: $3 for $nick $+ .
n301=      return
n302=    }
n303=    elseif ( ($2 == unban || $2 == unblock || $2 == unkick) && ($3 != $null) ) {
n304=      if (%sphere.ver == 0.55i) { sockwrite -tn sphere account $3 block 0 }
n305=      elseif (%sphere.ver == 0.99x) { sockwrite -tn sphere accountmgr $3 block 0 }
n306=      .notice $nick Unbanned account: $3 $+ .
n307=      sockwrite -tn sphere A
n308=      sends Unbanned account: $3 for $nick $+ .
n309=      return
n310=    }
n311=    elseif ( ($2 == add) && ($3 != $null) ) {
n312=      if (%sphere.ver == 0.55i) { sockwrite -tn sphere account add $3 $4 }
n313=      elseif (%sphere.ver == 0.99x) { sockwrite -tn sphere accountmgr add $3 $4 }
n314=      .notice $nick Account: $3 added, password: $4 $+ .
n315=      sockwrite -tn sphere A
n316=      sends Account $3 added by $nick $+ .
n317=      return
n318=    }
n319=    elseif ( ($2 == del || $2 == delete) && ($3 != $null) ) {
n320=      if (%sphere.ver == 0.55i) { sockwrite -tn sphere account $3 delete }
n321=      elseif (%sphere.ver == 0.99x) { sockwrite -tn sphere accountmgr $3 delete }
n322=      .notice $nick Account: $3 deleted.
n323=      sockwrite -tn sphere A
n324=      sends Account $3 deleted by $nick $+ .
n325=      return
n326=    }
n327=    elseif ($2 == connect) { 
n328=      if ($sock(sphere).active == 1) { sends Already connected. }
n329=      else {
n330=        spherecon
n331=        sends Connecting...
n332=      }
n333=    }
n334=  }
n335=}
